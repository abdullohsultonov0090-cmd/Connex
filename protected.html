<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Protected - Connex</title>
  <style>
    body{font-family:Inter,Segoe UI,Roboto,sans-serif;display:flex;align-items:center;justify-content:center;min-height:100vh;background:#f3f4f6;margin:0}
    .card{background:#fff;padding:28px;border-radius:12px;box-shadow:0 12px 40px rgba(0,0,0,0.08);max-width:520px;width:100%;}
    .avatar{width:72px;height:72px;border-radius:50%;overflow:hidden;margin-right:16px}
    .meta{display:flex;align-items:center}
    .name{font-size:20px;font-weight:700}
    .muted{color:#6b7280}
    .actions{margin-top:18px}
    .btn{background:#2563eb;color:#fff;padding:10px 14px;border-radius:10px;border:none;cursor:pointer}
  </style>
</head>
<body>
  <div class="card">
    <div id="content">
      <div class="meta">
        <div class="avatar" id="userAvatar"></div>
        <div>
          <div class="name" id="userName">Loading...</div>
          <div class="muted" id="userEmail"></div>
        </div>
      </div>
      <div class="actions">
        <button id="logoutBtn" class="btn">Log out</button>
      </div>
    </div>
  </div>
<script>
// Fetch the authenticated user from /api/user and display it.
async function loadUser(){
  try{
    const res = await fetch('/api/user', { credentials: 'same-origin' });
    if(!res.ok) { window.location.href = '/'; return; }
    const data = await res.json();
    if(!data.user){ window.location.href = '/'; return; }
    const u = data.user;
    document.getElementById('userName').innerText = u.name || 'Unknown';
    document.getElementById('userEmail').innerText = u.email || '';
    if(u.avatarUrl){
      document.getElementById('userAvatar').innerHTML = `<img src="${u.avatarUrl}" style="width:100%;height:100%;object-fit:cover">`;
    }else{
      document.getElementById('userAvatar').innerHTML = `<div style="width:72px;height:72px;display:flex;align-items:center;justify-content:center;background:#e6eefc;color:#2563eb;font-weight:700;font-size:28px">${(u.name||'U')[0]}</div>`;
    }
  }catch(e){
    console.error(e);
    // If fetch fails, redirect to home
    window.location.href = '/';
  }
}

document.getElementById('logoutBtn').addEventListener('click', async ()=>{
  await fetch('/api/logout', { credentials: 'same-origin' });
  window.location.href = '/';
});

loadUser();
</script>
</body>
</html>